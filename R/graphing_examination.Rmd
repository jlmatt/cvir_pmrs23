---
title: "pmrs_examine_raw_data"
subtitle:
author: |
   Texas A&M University-Corpus Christi
output:
    github_document:
    toc: true
    toc_depth: 2
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(warning = FALSE, message = FALSE) 
library(tidyverse)
library(here)
library(janitor)
library(readxl)
library(skimr)
library(RColorBrewer)
```

```{r}
data <- readRDS(here::here("data","derived","clean_data.RDS"))
```

```{r}
str(data)
```

# Data adjustment for graphing

Take out IND data, doesn't add anything

```{r}
data <- data %>%
  filter(!sample_site == "IND")
```

# Number of females 

```{r}
fem <- data %>%
  filter(sex =="F") %>%
  group_by(sample_site,latitude,date,bay) %>%
  summarise(n=n()) %>%
  mutate(latitude = as.numeric(latitude)) %>%
  ungroup()

str(fem)
```

```{r}
ggplot(fem, aes(x = date , y = n, color = latitude,shape = fct_reorder(sample_site,latitude,.desc = TRUE))) +
  geom_point(size = 4) +
  geom_line() + 
  scale_color_gradientn(colors = (brewer.pal(9, "RdYlGn"))) +
  labs(color = "Latitude") + 
  scale_shape_manual(values=seq(0,15)) + 
  theme_dark()
```


```{r}
ggplot(fem, aes(x = date , y = n, color = fct_reorder(bay,latitude, .desc = TRUE),shape = fct_reorder(sample_site,latitude,.desc = TRUE))) +
  geom_point(size = 5) +
  geom_line() + 
  scale_color_brewer(palette = "RdYlGn",direction = -1)+
  labs(color = "Latitude") + 
  scale_shape_manual(values=seq(0,15)) + 
  theme(panel.background = element_rect(fill = "gray70"),  
        panel.grid.major = element_line(size = 0.5, linetype = 'solid',
                                colour = "gray"), 
  panel.grid.minor = element_line(size = 0.25, linetype = 'solid',
                                colour = "gray"))
```


# Wt_spec_fecundity

Filter out outliers to look at later

```{r}
data <- data %>%
  filter(!tube_id == "JAN_UVB_14")
```

```{r}
fec <- data %>%
  filter(sex =="F") %>%
  group_by(sample_site,latitude,date,bay) %>%
  summarise(md=median(wt_adj_fec,na.rm = TRUE)) %>%
  mutate(latitude = as.numeric(latitude)) %>%
  ungroup()

str(fec)
```


```{r}

site_codes<-fec %>%
  group_by(sample_site,bay) %>%
  summarize(
    n=n()
  ) %>%
  arrange(bay) %>%
  ungroup() %>%
  mutate(code_site = c(1,2,1,2,3,1,2,1,1,2,1,2,1,2,1,2)) %>%
  select(-n)

site_info <- data %>%
  select(sample_site,latitude) %>%
  unique()

site_codes <- site_codes %>%
  left_join(.,site_info,by = "sample_site") %>%
  arrange(desc(latitude)) %>%
  select(sample_site,code_site)

fec <- fec %>%
  left_join(.,site_codes, by = "sample_site") %>%
  mutate(code_site = as.factor(code_site))
```

# TEST GRAPH 1

What I need is a vector of colors associated with each site (based on bay) and a vector of shapes associated with each site (based on site code)

First make fec with bay_sample_site, 

```{r}
fec <- fec %>%
  mutate(key = paste(bay,sample_site,sep = "_")) 
```

then make a color for each bay

```{r}
bay_colors <- data %>%
  select(bay,latitude) %>%
  unique() %>%
  arrange(desc(latitude)) %>%
  select(bay) %>%
  unique() %>%
  mutate(color = rev(brewer.pal(8, "RdYlGn")))
```

and we already have a shape for each sample site

add bay_colors to fec, pull out just key, color, and code site

```{r}
fec <-fec %>%
  left_join(.,bay_colors, by = "bay")
```

```{r}
legend <- fec %>%
  arrange(desc(latitude)) %>%
  select(key,color,code_site) %>%
  unique()

colors <- legend %>%
  pull(color)

shapes <- legend %>%
  mutate(code_site = as.numeric(code_site)) %>%
  mutate(code_site = if_else(code_site == 1,21,code_site)) %>%
  mutate(code_site = if_else(code_site == 2,22,code_site)) %>%
  mutate(code_site = if_else(code_site == 3,23,code_site)) %>%
  pull(code_site)

key <- legend %>%
  pull(key)
```


```{r}

ggplot(fec, aes(x = date , y = md, 
                fill= fct_reorder(key,latitude, .desc = TRUE),
                shape = fct_reorder(key,latitude, .desc = TRUE),
                color = fct_reorder(bay,latitude, .desc = TRUE))) +
  geom_point(size = 5, stroke = 1, color = "black") + 
  geom_line(linewidth = 1) +
  scale_color_manual(values = rev(brewer.pal(8, "RdYlGn"))) +
  scale_fill_manual(name = "Sites",
                     labels = key,
                     values = colors) +
  scale_shape_manual(name = "Sites",
                     labels = key,
                     values = shapes)
```

```{r}
ggplot(fec, aes(x = date, y = md, color = fct_reorder(key, latitude, .desc = TRUE), 
                shape = fct_reorder(key, latitude, .desc = TRUE))) +
  geom_point(size = 5, color = "black", fill = "white", stroke = 1) +  # Add border here
  geom_line() +
  scale_color_manual(name = "Sites", labels = levels(fec$key), values = colors) +
  scale_shape_manual(name = "Sites", labels = levels(fec$key), values = shapes) +
  theme_minimal()
```



# TEST GRAPH 2

```{r}
ggplot(fec, aes(x = date , y = md, color = fct_reorder(bay,latitude, .desc = TRUE),shape = fct_reorder(code_site,latitude, .desc = TRUE))) +
  geom_point(size = 5) +
  geom_line() + 
  scale_color_brewer(palette = "RdYlGn",direction = -1)+
  labs(color = "Bay",shape = "Site") + 
  scale_shape_manual(name = "Sites",
                     labels = sites,
                     values = shapes) +
  theme(panel.background = element_rect(fill = "gray70"),  
        panel.grid.major = element_line(size = 0.5, linetype = 'solid',
                                colour = "gray"), 
  panel.grid.minor = element_line(size = 0.25, linetype = 'solid',
                                colour = "gray"))
```




# DEFAULT GRAPH
```{r}
ggplot(fec, aes(x = date , y = md, color = fct_reorder(bay,latitude, .desc = TRUE),shape = fct_reorder(sample_site,latitude,.desc = TRUE))) +
  geom_point(size = 5) +
  geom_line() + 
  scale_color_brewer(palette = "RdYlGn",direction = -1)+
  labs(color = "Bay",shape = "Site") + 
  scale_shape_manual(values=seq(0,14)) + 
  theme(panel.background = element_rect(fill = "gray70"),  
        panel.grid.major = element_line(size = 0.5, linetype = 'solid',
                                colour = "gray"), 
  panel.grid.minor = element_line(size = 0.25, linetype = 'solid',
                                colour = "gray"))
```






```{r}
ggplot(fec, aes(x = date , y = md, color = fct_reorder(bay,latitude, .desc = TRUE),shape = fct_reorder(sample_site,latitude,.desc = TRUE))) +
  geom_point(size = 5) +
  geom_line() + 
  scale_color_brewer(palette = "RdYlGn",direction = -1)+
  labs(color = "Bay",shape = "Site") + 
      scale_shape_manual(values = c(16, 17)) +  # Use filled shapes, specify only two shapes
      labs(color = "Bay", shape = "Site") + 
      theme(panel.background = element_rect(fill = "white"),  # Change background to white
            panel.grid.major = element_line(size = 0.5, linetype = 'solid', colour = "gray80"), 
            panel.grid.minor = element_line(size = 0.25, linetype = 'solid', colour = "gray90"),
            legend.background = element_rect(fill = "white", color = "gray80"),  # White legend background
            legend.key = element_rect(fill = "white")) 
```



```{r}
ggplot(fec, aes(x = date, y = md, 
                             color = fct_reorder(bay, latitude, .desc = TRUE),
                             shape = fct_reorder(sample_site, latitude, .desc = TRUE))) +
      geom_point(size = 5, fill = "white", stroke = 1.5) +  # Use filled symbols
      geom_line() + 
      scale_color_brewer(palette = "RdYlGn",direction = -1)+
      scale_shape_manual(values = c(16, 17)) +  # Use filled shapes, specify only two shapes
      labs(color = "Bay", shape = "Site") + 
      theme(panel.background = element_rect(fill = "white"),  # Change background to white
            panel.grid.major = element_line(size = 0.5, linetype = 'solid', colour = "gray80"), 
            panel.grid.minor = element_line(size = 0.25, linetype = 'solid', colour = "gray90"),
            legend.background = element_rect(fill = "white", color = "gray80"),  # White legend background
            legend.key = element_rect(fill = "white")) 
```


```{r}
look <- data %>%
  filter(sample_site == "UVB") %>%
  filter(date < "2024-02-02")
  
```


```{r}
ggplot(fec, aes(x = date, y = md, color = bay, shape = sample_site)) +
  geom_point(size = 4) + # Adjust size as needed
  scale_shape_manual(values = c(15, 17)) + # 15 = filled square, 17 = filled triangle
  labs(color = "Bay", shape = "Sample Site") +
  theme_minimal()
```



